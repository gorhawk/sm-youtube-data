(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{603:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var s=a(5155),r=a(9820),l=a(2115),n=a(4100);function i(){let{instance:e}=(0,r.dk)();return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-sky-200/60 to-blue-50 px-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-semibold text-gray-800 mb-8",children:"Bel\xe9p\xe9s"}),(0,s.jsxs)("button",{onClick:()=>{e.loginPopup(n.$).catch(e=>console.error(e))},className:"flex items-center gap-2 bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition cursor-pointer",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-6 w-6 text-white",children:(0,s.jsx)("path",{d:"M1 1h10v10H1zM13 1h10v10H13zM1 13h10v10H1zM13 13h10v10H13z"})}),"Sign in with Microsoft"]})]})}var o=a(1191);function c(e){let t=btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return"https://graph.microsoft.com/v1.0/shares/u!".concat(t,"/driveItem")}let d={scopes:["User.Read","Files.Read","Files.Read.All","offline_access"]},h=async(e,t)=>{try{return(await e.acquireTokenSilent({...d,account:t})).accessToken}catch(t){if(t instanceof o.CB)return(await e.acquireTokenPopup(d)).accessToken;throw t}};function x(e,t){let[a,s]=(0,l.useState)(()=>{try{let a=localStorage.getItem(e);return a?JSON.parse(a):t}catch(e){return t}});return[a,s]}async function m(e,t){let a={};for(let r=0;r<e.length;r+=50){var s;let l=e.slice(r,r+50),n=await fetch("https://content-youtube.googleapis.com/youtube/v3/videos?id=".concat(l.join(),"&part=statistics&key=").concat(t)),i=await n.json();if(console.log(r,i),null==(s=i.items)||s.forEach(e=>{var t;a[null==e?void 0:e.id]=Number(null==e||null==(t=e.statistics)?void 0:t.viewCount)}),i.error){console.error("found error, breaking loop",i.error);break}}return a}var u=a(2596);function g(e){let{type:t,className:a,...r}=e;return(0,s.jsx)("input",{type:"text",className:(0,u.A)("bg-gray-50 border border-gray-300 px-2 py-1 text-sm w-full rounded","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","dark:bg-gray-200 dark:text-slate-700 dark:border-slate-500 dark:placeholder:text-slate-400",a),...r})}function v(e){let{children:t,className:a,...r}=e;return(0,s.jsx)("button",{className:(0,u.A)("px-4 py-1 bg-slate-700 text-white text-sm font-bold rounded-md shadow border-2 border-solid border-slate-700 whitespace-nowrap","hover:cursor-pointer hover:bg-slate-600 hover:border-slate-600","dark:bg-slate-300 dark:text-slate-700 dark:border-slate-300 dark:hover:bg-slate-100 dark:hover:border-slate-100",a),...r,children:t})}function p(){return(0,s.jsxs)("svg",{width:"1rem",height:"1rem",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"animate-spin",children:[(0,s.jsx)("path",{d:"M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z",opacity:".25"}),(0,s.jsx)("path",{d:"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"})]})}var f=function(e){return e[e.Idle=0]="Idle",e[e.Checking=1]="Checking",e[e.Valid=2]="Valid",e[e.Invalid=3]="Invalid",e}({});let b={0:{class:"text-gray-400 dark:text-gray-500",content:"n/a"},1:{class:"text-slate-500 dark:text-slate-400",content:(0,s.jsx)(p,{})},2:{class:"text-green-600 dark:text-teal-500",content:"✔"},3:{class:"text-red-600 dark:text-red-500",content:"invalid ✕"}};var w=a(2105);function k(e){var t;let{instance:a,accounts:n}=(0,r.dk)(),i=n[0],[o,d]=(0,l.useState)(null!=(t=e.initLink)?t:""),[x,m]=(0,l.useState)(""),[p,k]=(0,l.useState)(e.initLink?f.Valid:f.Idle),j=async()=>{if(o){k(f.Checking),m("");try{var t,s;let r=await h(a,i),l=c(o),n=await fetch(l,{headers:{Authorization:"Bearer ".concat(r)}});if(!n.ok){k(f.Invalid),m("Rossz link");return}let d=await n.json();(null==d||null==(t=d.name)?void 0:t.endsWith(".xlsx"))||(null==d||null==(s=d.name)?void 0:s.endsWith(".xls"))?(k(f.Valid),m("Excel f\xe1jl: ".concat(d.name)),e.onSuccess(o,d.name)):(k(f.Invalid),m("Rossz f\xe1jlform\xe1tum: ".concat(d.name)))}catch(e){console.error(e),w.Cp(e),k(f.Invalid),m("Hiba")}}};return(0,s.jsxs)("div",{className:"flex gap-4 items-center flex-wrap",children:[(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsx)("div",{className:"min-w-36 whitespace-nowrap",children:(0,s.jsx)("label",{className:"font-semibold",children:"Excel t\xe1bl\xe1zat link:"})}),(0,s.jsx)("div",{className:"min-w-md",children:(0,s.jsx)(g,{placeholder:"Sharepoint Excel link",value:o,onChange:e=>d(e.target.value)})}),(0,s.jsx)(v,{onClick:j,disabled:p===f.Checking||!i,children:(0,s.jsx)("div",{className:"min-w-20",children:"Link teszt"})})]}),(0,s.jsxs)("div",{className:(0,u.A)("flex gap-1 items-center",b[p].class),children:[(0,s.jsx)("div",{children:"F\xe1jl: "}),(0,s.jsxs)("div",{className:"min-w-4 whitespace-nowrap",children:[p===f.Valid&&e.filename," ",b[p].content]})]})]})}function j(e){var t;let[a,r]=(0,l.useState)(null!=(t=e.initKey)?t:""),[n,i]=(0,l.useState)(e.initKey?f.Valid:f.Idle),o=async()=>{i(f.Checking);try{var t,s,r,l,n,o;let c=await fetch("https://www.googleapis.com/youtube/v3/channels?part=id&key=".concat(a)),d=await c.json();c.ok&&"youtube#channelListResponse"===d.kind?(console.log("API key is valid"),i(f.Valid),e.onSuccess(a)):400===c.status&&(null==(s=d.error)||null==(t=s.errors)?void 0:t.some(e=>"missingRequiredParameter"===e.reason))?(i(f.Valid),e.onSuccess(a)):(400===c.status&&(null==(r=d.error)?void 0:r.status)==="INVALID_ARGUMENT"&&(null==(n=d.error)||null==(l=n.details)?void 0:l.some(e=>"API_KEY_INVALID"===e.reason))||console.log("Invalid or restricted API key, ",null==(o=d.error)?void 0:o.message),i(f.Invalid))}catch(e){console.error(e),w.Cp(e),i(f.Invalid)}};return(0,s.jsxs)("div",{className:"flex gap-4 items-center flex-wrap",children:[(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsx)("div",{className:"min-w-36 whitespace-nowrap",children:(0,s.jsx)("label",{className:"font-semibold",children:"YouTube API kulcs:"})}),(0,s.jsx)("div",{className:"min-w-[26rem]",children:(0,s.jsx)(g,{value:a,onChange:e=>r(e.target.value),placeholder:"AIzaSyCqh..."})}),(0,s.jsx)(v,{onClick:o,disabled:n===f.Checking,children:(0,s.jsx)("div",{className:"flex gap-2 items-center",children:(0,s.jsx)("div",{className:"min-w-28 text-center",children:"API kulcs teszt"})})})]}),(0,s.jsxs)("div",{className:(0,u.A)("flex gap-1 items-center",b[n].class),children:[(0,s.jsx)("div",{children:"Kulcs: "}),(0,s.jsxs)("div",{className:"min-w-4 whitespace-nowrap",children:[n===f.Valid&&e.initKey," ",b[n].content]})]})]})}function y(e){let{title:t,onClick:a,isActive:r}=e;return(0,s.jsx)("button",{className:(0,u.A)("px-1.5 py-0.5 h-6 text-xs rounded-md shadow whitespace-nowrap hover:cursor-pointer box-border border border-solid border-slate-700",!r&&"bg-transparent hover:bg-slate-100 dark:hover:bg-slate-600 dark:border-slate-600",r&&"bg-slate-700 text-white hover:bg-slate-600 dark:bg-slate-300 dark:text-slate-700 dark:border-slate-300 dark:hover:bg-slate-400 dark:hover:border-slate-400"),onClick:a,children:t})}var N=function(e){return e[e.NONE=0]="NONE",e[e.VIEWS_ASC=1]="VIEWS_ASC",e[e.VIEWS_DESC=2]="VIEWS_DESC",e}(N||{});let S={0:{nextDir:2,icon:"⭥"},2:{nextDir:1,icon:"⭣"},1:{nextDir:0,icon:"⭡"}};function I(){let{instance:e,accounts:t}=(0,r.dk)(),[a]=t,[n,i]=x("views",{}),[o,d]=x("videos",[]),[f,b]=x("excel_link",""),[N,I]=x("excel_filename",""),[C,_]=x("youtube_api_key","AIzaSyD16bBaaCnZ5fLB5n3Rp-h_ulyahTJlzRk"),[A,E]=(0,l.useState)([]),[z,V]=(0,l.useState)(0),[T,O]=(0,l.useState)(""),[R,D]=(0,l.useState)(!1),[L,J]=(0,l.useState)(!1),[P,B]=x("views_date",void 0),[M,F]=x("videos_date",void 0),K=o.map(e=>e.channel).filter((e,t,a)=>a.indexOf(e)===t),W=async()=>{D(!0),J(!1);try{let t=await h(e,a),s={Authorization:"Bearer ".concat(t)},r=await fetch(c(f),{headers:s}),l=await r.json();console.log(l);let n=l.id,o=l.parentReference.driveId,x=await fetch("https://graph.microsoft.com/v1.0/drives/".concat(o,"/items/").concat(n,"/workbook/worksheets('").concat("tracks1","')/usedRange"),{headers:s}),u=await x.json();console.log(u);let g=u.values.slice(1).map(e=>{let[t,a,s]=e;return{channel:t,track:a,link:s,videoId:new URL(s).searchParams.get("v")}}).filter(e=>null!==e.videoId),v=g.map(e=>e.videoId),p=await m(v,C),b=Date.now();i(p),d(g),B(b),F(b),D(!1),J(!1),setTimeout(()=>{window.localStorage.setItem("views",JSON.stringify(p)),window.localStorage.setItem("videos",JSON.stringify(g)),window.localStorage.setItem("views_date",JSON.stringify(b)),window.localStorage.setItem("videos_date",JSON.stringify(b))},100)}catch(e){console.error(e),w.Cp(e),D(!1),J(!0)}},H=async()=>{if(o.length){D(!0),J(!1);try{let e=await m(o.map(e=>e.videoId),C),t=Date.now();i(e),B(t),D(!1),J(!1),setTimeout(()=>{window.localStorage.setItem("views",JSON.stringify(e)),window.localStorage.setItem("views_date",JSON.stringify(t))},100)}catch(e){console.error(e),w.Cp(e),D(!1),J(!0)}}},U=e=>{A.includes(e)?E(A.filter(t=>t!==e)):E([...A,e])},q=o;return A.length>0&&(q=q.filter(e=>A.includes(e.channel))),T.length>0&&(q=q.filter(e=>e.track.toLowerCase().includes(T.toLowerCase()))),0!==z&&(q=q.toSorted((e,t)=>{var a,s;let r=(null!=(a=n[e.videoId])?a:0)-(null!=(s=n[t.videoId])?s:0);return 1===z?r:-r})),(0,s.jsxs)("div",{className:"mx-8 mb-12 max-w-7xl pt-6 text-sm text-slate-700 dark:text-slate-300",children:[(0,s.jsx)("div",{className:"mb-4 gap-2",children:(0,s.jsx)(k,{initLink:f,filename:N,onSuccess:(e,t)=>{b(e),I(t),setTimeout(()=>{window.localStorage.setItem("excel_link",JSON.stringify(e)),window.localStorage.setItem("excel_filename",JSON.stringify(t))},50)}})}),(0,s.jsx)("div",{className:"my-4 gap-2",children:(0,s.jsx)(j,{initKey:C,onSuccess:e=>{_(e),setTimeout(()=>{window.localStorage.setItem("youtube_api_key",JSON.stringify(e))},50)}})}),(0,s.jsxs)("div",{className:(0,u.A)("mt-12",{"opacity-30 pointer-events-none select-none":(!f||!C)&&!o.length}),children:[(0,s.jsxs)("div",{className:"my-12 flex gap-4 items-center flex-wrap",children:[(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsx)("div",{className:"font-semibold whitespace-nowrap",children:"Adatok bet\xf6lt\xe9se:"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v,{onClick:W,title:"Vide\xf3k \xe9s n\xe9zetts\xe9g let\xf6lt\xe9se",disabled:R,children:"Vide\xf3k\xa0⬇"}),(0,s.jsxs)(v,{onClick:H,title:"N\xe9zetts\xe9g friss\xedt\xe9se",disabled:R||0===o.length,children:["N\xe9zetts\xe9g\xa0",(0,s.jsx)("span",{className:"",children:"↻"})]})]}),R&&(0,s.jsx)("div",{children:(0,s.jsx)(p,{})}),L&&(0,s.jsx)("div",{className:"text-red-600",children:"✕"})]}),(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[M&&(0,s.jsxs)("div",{className:"text-slate-400 whitespace-nowrap dark:text-slate-600",children:["Vide\xf3k (",new Date(M).toLocaleString("sv-SE"),")"]}),P&&(0,s.jsxs)("div",{className:"text-slate-400 whitespace-nowrap dark:text-slate-600",children:["N\xe9zetts\xe9g (",new Date(P).toLocaleString("sv-SE"),")"]})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 my-4 items-center",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-center grow",children:[(0,s.jsx)("div",{className:"block font-bold",children:"Filter:"}),(0,s.jsx)("div",{className:"flex gap-2 flex-wrap",children:K.map(e=>(0,s.jsx)(y,{title:e,onClick:()=>U(e),isActive:A.includes(e)},e))})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center grow-5 max-w-72",children:[(0,s.jsx)("label",{className:"block font-bold",htmlFor:"filterText",children:"Track:"}),(0,s.jsx)("div",{className:"grow min-w-32",children:(0,s.jsx)(g,{id:"filterText",name:"filterText",value:T,placeholder:"Keres\xe9s n\xe9vre",onChange:e=>O(e.target.value)})})]})]}),(0,s.jsxs)("div",{className:"max-w-full",children:[(0,s.jsxs)("table",{className:"w-full max-w-full border-collapse bg-transparent shadow-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-100 font-bold text-gray-700 dark:bg-slate-700 dark:text-slate-200",children:[(0,s.jsx)("th",{className:"border border-gray-300 px-4 py-1 text-left dark:border-slate-500",children:"Csatorna"}),(0,s.jsx)("th",{className:"border border-gray-300 px-4 py-1 text-left dark:border-slate-500",children:"Track"}),(0,s.jsx)("th",{className:"border border-gray-300 px-4 py-1 text-left dark:border-slate-500",children:"Youtube link"}),(0,s.jsx)("th",{className:"border border-gray-300 px-4 py-1 text-left select-none cursor-pointer hover:bg-gray-200 dark:border-slate-500  dark:hover:bg-gray-600",children:(0,s.jsxs)("div",{onClick:()=>{V(S[z].nextDir)},children:["N\xe9zetts\xe9g\xa0",S[z].icon]})})]})}),(0,s.jsx)("tbody",{className:"text-gray-900 dark:text-gray-300",children:q.map((e,t)=>{var a;return(0,s.jsxs)("tr",{className:"bg-transparent even:bg-gray-50 dark:even:bg-gray-700/25",children:[(0,s.jsx)("td",{className:"border border-gray-300 px-4 py-1 whitespace-nowrap dark:border-slate-500",children:e.channel}),(0,s.jsx)("td",{className:"border border-gray-300 px-4 py-1 dark:border-slate-500",children:e.track}),(0,s.jsx)("td",{className:(0,u.A)("border border-gray-300 px-4 py-1 text-blue-600 hover:text-blue-800","dark:border-slate-500 dark:text-cyan-500 dark:hover:text-sky-300"),children:(0,s.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"block hover:underline overflow-hidden text-ellipsis whitespace-nowrap max-w-sm",title:e.link,children:e.link})}),(0,s.jsx)("td",{className:"border border-gray-300 px-4 py-1 dark:border-slate-500",children:null==(a=n[e.videoId])?void 0:a.toLocaleString()})]},t)})})]}),0===q.length&&(0,s.jsx)("div",{className:"p-4 text-center",children:o.length>0?"Nincs tal\xe1lat.":"Nincsenek vide\xf3k"})]})]})]})}var C=a(1429);function _(){return(0,l.useEffect)(()=>{C.T({dsn:"https://fc5087736dbf8399c418e8fa47586d0f@o4509264262594560.ingest.de.sentry.io/4509264266985552",sendDefaultPii:!0})}),(0,s.jsxs)(l.Fragment,{children:[(0,s.jsx)(r.hj,{children:(0,s.jsx)(i,{})}),(0,s.jsx)(r.e7,{children:(0,s.jsx)(I,{})})]})}},4100:(e,t,a)=>{"use strict";a.d(t,{$:()=>r,w:()=>s});let s={auth:{clientId:"ef50611d-7581-4943-b9fe-3e893c2a7005",authority:"https://login.microsoftonline.com/a2000560-ea4b-4f9a-b537-fd0e3e0142b8",redirectUri:"https://gorhawk.github.io/sm-youtube-data"}},r={scopes:["User.Read","Files.Read","offline_access"]}},6484:(e,t,a)=>{Promise.resolve().then(a.bind(a,603))}},e=>{var t=t=>e(e.s=t);e.O(0,[820,54,441,684,358],()=>t(6484)),_N_E=e.O()}]);